(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{10:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"e",(function(){return isNumber})),__webpack_require__.d(__webpack_exports__,"d",(function(){return isDefine})),__webpack_require__.d(__webpack_exports__,"f",(function(){return lastBy})),__webpack_require__.d(__webpack_exports__,"h",(function(){return number2px})),__webpack_require__.d(__webpack_exports__,"i",(function(){return uuid})),__webpack_require__.d(__webpack_exports__,"b",(function(){return createCpnSchema})),__webpack_require__.d(__webpack_exports__,"g",(function(){return minYby})),__webpack_require__.d(__webpack_exports__,"j",(function(){return windowToWrapper})),__webpack_require__.d(__webpack_exports__,"c",(function(){return getWrapperIdBy})),__webpack_require__.d(__webpack_exports__,"a",(function(){return arrDel}));__webpack_require__(35),__webpack_require__(67),__webpack_require__(65),__webpack_require__(720),__webpack_require__(232),__webpack_require__(38),__webpack_require__(54),__webpack_require__(78),__webpack_require__(247),__webpack_require__(16),__webpack_require__(3);var isNumber=function isNumber(val){return"number"==typeof val},isDefine=function isDefine(val){return null!=val},lastBy=function lastBy(arr){return arr[arr.length-1]},number2px=function number2px(val){if(isDefine(val))return"number"==typeof val?"".concat(val,"px"):val},uuidOffset=0,uuid=function uuid(){return uuidOffset++,(Date.now()+uuidOffset).toString(16).substr(3)},createCpnSchema=function createCpnSchema(store,manifest){var config=function findConfigById(store,name){var _store$configs;if(!(null==store||null===(_store$configs=store.configs)||void 0===_store$configs?void 0:_store$configs.length))throw new Error("please check config");var config=store.configs.find((function(config){return config.name===name}));if(!config)throw new Error("please check widget");return config}(store,manifest.name);return{manifest:manifest,config:config,props:config.props,id:uuid(),children:[]}},minYby=function minYby(configs){for(var minY=0,i=0;i<configs.length;i++){var config=configs[i].config;minY<config.y+config.height&&(minY=config.y+config.height)}return minY},windowToWrapper=function windowToWrapper(ele,x,y){var box=ele.getBoundingClientRect();return{x:x-box.left,y:y-box.top}},getWrapperIdBy=function getWrapperIdBy(schema,item){for(var id=schema[item.id].parent;!schema[id].config.canAddAsChild;)id=schema[id].parent;return id},arrDel=function arrDel(list,value){var clone=list.slice(),index=clone.indexOf(value);return index>=0&&clone.splice(index,1),clone}},107:function(module,__webpack_exports__,__webpack_require__){"use strict";var _Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__),_hooks_use_schema__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(95),_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(10);__webpack_require__(732);__webpack_exports__.a=function Widget(_ref){var manifest=_ref.manifest,children=_ref.children,_useSchema=Object(_hooks_use_schema__WEBPACK_IMPORTED_MODULE_2__.b)(),_useSchema2=Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__.a)(_useSchema,2),store=_useSchema2[0],dispatch=_useSchema2[1];return react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement("div",{"data-testid":"widget",className:"jigsaw-widget",onClick:function handleClick(){var schema=Object(_utils__WEBPACK_IMPORTED_MODULE_3__.b)(store,manifest);dispatch(_hooks_use_schema__WEBPACK_IMPORTED_MODULE_2__.a.ADD,schema)}},children)};try{widget.displayName="widget",widget.__docgenInfo={description:"",displayName:"widget",props:{manifest:{defaultValue:null,description:"",name:"manifest",required:!0,type:{name:"Manifest"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/widget/index.tsx#widget"]={docgenInfo:widget.__docgenInfo,name:"widget",path:"src/widget/index.tsx#widget"})}catch(__react_docgen_typescript_loader_error){}},153:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__(718);var App=__webpack_require__(154),react=__webpack_require__(0),react_default=__webpack_require__.n(react),floor_config={name:"Floor",width:"100%",x:0,y:0,height:650,canDrag:!1,canAddAsChild:!0,props:{}},manifest=__webpack_require__(184),floor_Floor=function Floor(_ref){var children=_ref.children;return react_default.a.createElement("div",null,children)},floor={view:Object(react.memo)(floor_Floor),config:floor_config,manifest:manifest.a},objectWithoutProperties=(__webpack_require__(55),__webpack_require__(124)),es_button=__webpack_require__(750),Button_config={name:"Button",width:100,height:30,canDrag:!0,canAddAsChild:!1,props:{btnText:"按钮"}},Button_manifest={name:"Button",cname:"按钮",version:"1.0.0"},Button_JsButton=(__webpack_require__(723),function JsButton(_ref){var btnText=_ref.btnText,props=Object(objectWithoutProperties.a)(_ref,["btnText"]);return react_default.a.createElement(es_button.a,Object.assign({className:"js-button"},props),btnText)}),components_Button={view:Object(react.memo)(Button_JsButton),config:Button_config,manifest:Button_manifest},card=__webpack_require__(748),Card_config={name:"Card",width:300,height:180,canDrag:!0,canAddAsChild:!0,props:{bordered:!1,title:"卡片"}},Card_manifest={name:"Card",cname:"卡片",version:"1.0.0"},Card_JsCard=(__webpack_require__(726),function JsCard(_ref){var children=_ref.children,props=Object(objectWithoutProperties.a)(_ref,["children"]);return react_default.a.createElement(card.a,Object.assign({className:"js-card"},props),children)}),components_Card={view:Object(react.memo)(Card_JsCard),config:Card_config,manifest:Card_manifest},componentMap={App:App.a,Floor:floor,Button:components_Button,Card:components_Card};__webpack_exports__.a=componentMap},154:function(module,__webpack_exports__,__webpack_require__){"use strict";var slicedToArray=__webpack_require__(9),react=__webpack_require__(0),react_default=__webpack_require__.n(react),use_schema=__webpack_require__(95),key_code={DELETE:"Backspace"},App_config={name:"App",cname:"拼图",canDrag:!1,canAddAsChild:!0,props:{}},App_manifest={name:"App",cname:"拼图",version:"1.0.0"},options=(__webpack_require__(721),{view:function App(_ref){var children=_ref.children,_useSchema=Object(use_schema.b)(),_useSchema2=Object(slicedToArray.a)(_useSchema,2),store=_useSchema2[0],dispatch=_useSchema2[1],activityId=store.activityId,schema=store.schema;return Object(react.useEffect)((function(){var handleKeyPress=function handleKeyPress(e){e.code===key_code.DELETE&&activityId&&dispatch(use_schema.a.DELETE,schema[activityId])};return document.addEventListener("keydown",handleKeyPress),function(){document.removeEventListener("keydown",handleKeyPress)}}),[activityId,dispatch,schema]),react_default.a.createElement("div",{className:"jigsaw-app"},children)},config:App_config,manifest:App_manifest});__webpack_exports__.a=options},183:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return rootId})),__webpack_require__.d(__webpack_exports__,"a",(function(){return DirectionEnum}));var DirectionEnum,rootId="App";!function(DirectionEnum){DirectionEnum.TOP="TOP",DirectionEnum.BOTTOM="BOTTOM"}(DirectionEnum||(DirectionEnum={}))},184:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_exports__.a={name:"Floor",cname:"楼",version:"1.0.0"}},30:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return defaultContext}));__webpack_require__(69),__webpack_require__(172);var _Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(9),react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_3__),_components__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(153),_components_App__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(154),config=_components_App__WEBPACK_IMPORTED_MODULE_5__.a.config,manifest=_components_App__WEBPACK_IMPORTED_MODULE_5__.a.manifest,defaultContext={store:{configs:Object.entries(_components__WEBPACK_IMPORTED_MODULE_4__.a).map((function(_ref){return Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_2__.a)(_ref,2)[1].config})),activityId:"App",schema:{App:{id:"App",props:{},children:[],config:config,manifest:manifest}},dragInfo:{}}},ctx=react__WEBPACK_IMPORTED_MODULE_3___default.a.createContext(defaultContext);__webpack_exports__.a=ctx},362:function(module,exports,__webpack_require__){__webpack_require__(363),__webpack_require__(518),__webpack_require__(519),__webpack_require__(712),module.exports=__webpack_require__(716)},430:function(module,exports){},44:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"f",(function(){return getRootChildren})),__webpack_require__.d(__webpack_exports__,"c",(function(){return cloneDeepBy})),__webpack_require__.d(__webpack_exports__,"d",(function(){return deleteBy})),__webpack_require__.d(__webpack_exports__,"a",(function(){return addBy})),__webpack_require__.d(__webpack_exports__,"h",(function(){return replaceBy})),__webpack_require__.d(__webpack_exports__,"g",(function(){return initBy})),__webpack_require__.d(__webpack_exports__,"b",(function(){return addFloorBy})),__webpack_require__.d(__webpack_exports__,"e",(function(){return findLastActivityId}));__webpack_require__(69),__webpack_require__(50),__webpack_require__(51),__webpack_require__(31),__webpack_require__(92),__webpack_require__(174),__webpack_require__(38),__webpack_require__(78),__webpack_require__(247);var _Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(16),_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(36),_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(3),_common_constant__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(183),_floor_manifest__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(184),___WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(10),getRootChildren=function getRootChildren(schema){return schema.App.children},cloneDeepBy=function cloneDeepBy(schema,id){for(var result={},schemaList=function cloneDeep(schema,id){var _target$children,_ref,target=schema[id],newSchema=function clone(schema){return Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)({},schema),{},{id:Object(___WEBPACK_IMPORTED_MODULE_14__.i)()})}(target);if(0===(null===(_target$children=target.children)||void 0===_target$children?void 0:_target$children.length))return[newSchema];var childrenList=target.children.map((function(id){return cloneDeep(schema,id)}));return childrenList.forEach((function(item){item[0].parent=newSchema.id})),newSchema.children=childrenList.map((function(item){return item[0].id})),[newSchema].concat(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_10__.a)((_ref=[]).concat.apply(_ref,Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_10__.a)(childrenList))))}(schema,id),rootId=schemaList[0].id,l=schemaList.length,i=0;i<l;i++){var t=schemaList[i];result[t.id]=t}return[Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)({},schema),result),rootId]},deleteBy=function deleteBy(schema,id){var parent=schema[schema[id].parent],brother=null==parent?void 0:parent.children,cloneSchema=Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)({},schema);return function deepDelete(id){var cur=cloneSchema[id];0!==cur.children.length?cur.children.forEach((function(id){deepDelete(id)})):delete cloneSchema[id]}(id),Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)({},cloneSchema),{},Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_9__.a)({},parent.id,Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)({},parent),{},{children:null==brother?void 0:brother.filter((function(chId){return chId!==id}))})))},addBy=function addBy(schema,id,payload){var _objectSpread3;if(!schema)return Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_9__.a)({},payload.id,Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)({},payload));for(var container=schema[id]||schema.App;!container.config.canAddAsChild;)container=schema[container.parent];var childrenList=container.children.map((function(id){return schema[id]})),minY=Object(___WEBPACK_IMPORTED_MODULE_14__.g)(childrenList),newSchema=Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)({},payload),{},{parent:container.id,config:Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)({},payload.config),{},{x:0,y:minY,name:payload.manifest.cname})}),containerConfig=container.config,realHeight=containerConfig.height>minY+payload.config.height?containerConfig.height:minY+payload.config.height;return Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)({},schema),{},(_objectSpread3={},Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_9__.a)(_objectSpread3,newSchema.id,newSchema),Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_9__.a)(_objectSpread3,container.id,Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)({},container),{},{children:[].concat(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_10__.a)(container.children),[payload.id]),config:Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)({},containerConfig),{},{height:realHeight})})),_objectSpread3))},replaceBy=function replaceBy(schema,from,to){var parent=schema[schema[from].parent],children=null==parent?void 0:parent.children,cloneSchema=Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)({},schema),payload=Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)({},cloneSchema[from]);delete cloneSchema[from];var realSchema=addBy(schema,to,payload);return Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)({},realSchema),{},Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_9__.a)({},parent.id,Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)({},parent),{},{children:null==children?void 0:children.filter((function(chId){return chId!==from}))})))},initBy=function initBy(store,manifests){var schemaList=manifests.map((function(manifest){return Object(___WEBPACK_IMPORTED_MODULE_14__.b)(store,manifest)})),schema=store.schema;return[schemaList.reduce((function(acc,cur){return addBy(acc,cur.id,cur)}),schema),Object(___WEBPACK_IMPORTED_MODULE_14__.f)(schemaList).id]},addFloorBy=function addFloorBy(store,direction){var _objectSpread5,schema=store.schema,activityId=store.activityId,newFloor=Object(___WEBPACK_IMPORTED_MODULE_14__.b)(store,_floor_manifest__WEBPACK_IMPORTED_MODULE_13__.a),floor=function findFloorBy(schema,id){for(var floor=schema[id];"Floor"!==floor.manifest.name;)floor=schema[floor.parent];if(!floor)throw new Error("can't find floor");return floor}(schema,activityId),container=schema[floor.parent];newFloor.parent=container.id;var floorIds=Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_10__.a)(container.children),curIndex=floorIds.indexOf(floor.id);return direction===_common_constant__WEBPACK_IMPORTED_MODULE_12__.a.TOP?floorIds.splice(curIndex,0,newFloor.id):floorIds.splice(curIndex+1,0,newFloor.id),Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)({},store),{},{activityId:newFloor.id,schema:Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)({},schema),{},(_objectSpread5={},Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_9__.a)(_objectSpread5,container.id,Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_11__.a)({},container),{},{children:floorIds})),Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_9__.a)(_objectSpread5,newFloor.id,newFloor),_objectSpread5))})},findLastActivityId=function findLastActivityId(schema,payload){var children=schema[payload.parent].children;if(children.length<=1)return payload.parent;var index=children.indexOf(payload.id);return-1===index?payload.parent:0===index?children[index+1]:children[index-1]}},519:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__(297)},712:function(module,exports,__webpack_require__){"use strict";__webpack_require__(66),__webpack_require__(37),__webpack_require__(92),__webpack_require__(713),__webpack_require__(50),__webpack_require__(51),__webpack_require__(714),__webpack_require__(102),__webpack_require__(91);var _clientApi=__webpack_require__(164),_clientLogger=__webpack_require__(79),_configFilename=__webpack_require__(715);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}(_configFilename.args||_configFilename.argTypes)&&_clientLogger.logger.warn("Invalid args/argTypes in config, ignoring.",JSON.stringify({args:_configFilename.args,argTypes:_configFilename.argTypes})),_configFilename.decorators&&_configFilename.decorators.forEach((function(decorator){return(0,_clientApi.addDecorator)(decorator,!1)})),_configFilename.loaders&&_configFilename.loaders.forEach((function(loader){return(0,_clientApi.addLoader)(loader,!1)})),(_configFilename.parameters||_configFilename.globals||_configFilename.globalTypes)&&(0,_clientApi.addParameters)(_objectSpread(_objectSpread({},_configFilename.parameters),{},{globals:_configFilename.globals,globalTypes:_configFilename.globalTypes}),!1),_configFilename.argTypesEnhancers&&_configFilename.argTypesEnhancers.forEach((function(enhancer){return(0,_clientApi.addArgTypesEnhancer)(enhancer)}))},715:function(module,exports){},716:function(module,exports,__webpack_require__){"use strict";(function(module){(0,__webpack_require__(297).configure)([__webpack_require__(717)],module,!1)}).call(this,__webpack_require__(163)(module))},717:function(module,exports,__webpack_require__){var map={"./container/container.stories.tsx":745,"./tools/tools.stories.tsx":746,"./tree/tree.stories.tsx":743,"./widget/widget.stories.tsx":738,"./wrapper/wrapper.stories.tsx":744};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=717},721:function(module,exports,__webpack_require__){var api=__webpack_require__(70),content=__webpack_require__(722);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},722:function(module,exports,__webpack_require__){(exports=__webpack_require__(71)(!1)).push([module.i,".jigsaw-app{position:relative;width:375px;height:auto}\n",""]),module.exports=exports},723:function(module,exports,__webpack_require__){var api=__webpack_require__(70),content=__webpack_require__(724);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},724:function(module,exports,__webpack_require__){(exports=__webpack_require__(71)(!1)).push([module.i,".js-button{width:100%;height:100%;padding:0;overflow:hidden}\n",""]),module.exports=exports},726:function(module,exports,__webpack_require__){var api=__webpack_require__(70),content=__webpack_require__(727);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},727:function(module,exports,__webpack_require__){(exports=__webpack_require__(71)(!1)).push([module.i,".js-card{width:100%;height:100%;overflow:hidden;box-sizing:border-box}\n",""]),module.exports=exports},728:function(module,exports,__webpack_require__){var api=__webpack_require__(70),content=__webpack_require__(729);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},729:function(module,exports,__webpack_require__){(exports=__webpack_require__(71)(!1)).push([module.i,"",""]),module.exports=exports},730:function(module,exports,__webpack_require__){var api=__webpack_require__(70),content=__webpack_require__(731);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},731:function(module,exports,__webpack_require__){(exports=__webpack_require__(71)(!1)).push([module.i,"",""]),module.exports=exports},732:function(module,exports,__webpack_require__){var api=__webpack_require__(70),content=__webpack_require__(733);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},733:function(module,exports,__webpack_require__){(exports=__webpack_require__(71)(!1)).push([module.i,"",""]),module.exports=exports},736:function(module,exports,__webpack_require__){var api=__webpack_require__(70),content=__webpack_require__(737);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},737:function(module,exports,__webpack_require__){(exports=__webpack_require__(71)(!1)).push([module.i,'.jigsaw-tree{overflow:hidden}.jigsaw-tree-treenode{display:flex;padding:0 0 4px;outline:none;align-items:flex-start}.jigsaw-tree-switcher{width:24px;height:24px;transition:transform 0.3s ease-in;user-select:none}.jigsaw-tree-switcher:hover{cursor:pointer;transform:scale(1.3)}.jigsaw-tree-switcher-noop:hover{cursor:unset;transform:unset}.jigsaw-tree-switcher-open{transform:rotate(0)}.jigsaw-tree-switcher-close{transform:rotate(-90deg)}.jigsaw-tree-wrapper{flex:1;position:relative;z-index:auto;min-height:24px;margin:0;padding:0 4px;color:inherit;line-height:24px;background:0 0;border-radius:2px;cursor:pointer;transition:all .3s,border 0s,line-height 0s,box-shadow 0s}.jigsaw-tree-wrapper:hover{background-color:#f5f5f5}.jigsaw-tree-wrapper--selected{background-color:#bae7ff}.jigsaw-tree-wrapper--selected:hover{background-color:#bae7ff}.jigsaw-tree-indent{align-self:stretch;white-space:nowrap;user-select:none}.jigsaw-tree-indent-unit{position:relative;height:100%;display:inline-block;width:24px}.jigsaw-tree-indent-unit::before{position:absolute;top:0;right:12px;bottom:-4px;border-right:1px solid #d9d9d9;content:""}.jigsaw-tree-indent-unit-end::before{display:none}.jigsaw-tree-indicator{position:absolute;width:100%;z-index:1;height:2px;background-color:#1890ff;border-radius:1px;pointer-events:none}.jigsaw-tree-indicator::after{position:absolute;top:-3px;left:-6px;width:8px;height:8px;background-color:transparent;border:2px solid #1890ff;border-radius:50%;content:""}.jigsaw-tree svg{width:100%;height:100%;transition:transform .3s}\n',""]),module.exports=exports},738:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"WidgetDemo",(function(){return WidgetDemo}));__webpack_require__(31);var _Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(36),_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3),_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(9),react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_4__),react_json_view__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(359),react_json_view__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(react_json_view__WEBPACK_IMPORTED_MODULE_5__),___WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(107),_common_context__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(30),manifest={name:"test",version:"0.0.1",icon:"",preview:""},Container=function Container(){var _useState=Object(react__WEBPACK_IMPORTED_MODULE_4__.useState)(_common_context__WEBPACK_IMPORTED_MODULE_7__.b.store),_useState2=Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_3__.a)(_useState,2),store=_useState2[0],setStore=_useState2[1];Object(react__WEBPACK_IMPORTED_MODULE_4__.useEffect)((function(){setStore(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_2__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_2__.a)({},store),{},{configs:[].concat(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_1__.a)(store.configs),[{name:"test",width:100,height:100}])}))}),[]);var value={store:store,setStore:setStore};return react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("div",null,react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement(_common_context__WEBPACK_IMPORTED_MODULE_7__.a.Provider,{value:value},react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement(___WEBPACK_IMPORTED_MODULE_6__.a,{manifest:manifest},react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("div",null,"添加"))),react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement(react_json_view__WEBPACK_IMPORTED_MODULE_5___default.a,{src:store.schema}))};__webpack_exports__.default={title:"Widget"};var WidgetDemo=function WidgetDemo(){return react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement(Container,null)}},739:function(module,exports,__webpack_require__){var api=__webpack_require__(70),content=__webpack_require__(740);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},740:function(module,exports,__webpack_require__){(exports=__webpack_require__(71)(!1)).push([module.i,".jigsaw-dots{box-sizing:border-box;position:absolute;width:8px;height:8px;background:#fff;border:1px solid #000}.jigsaw-dots__left-top{transform:translateX(-50%) translateY(-50%);cursor:nwse-resize}.jigsaw-dots__center-top{left:50%;transform:translateX(-50%) translateY(-50%);cursor:ns-resize}.jigsaw-dots__right-top{right:0;transform:translateX(50%) translateY(-50%);cursor:nesw-resize}.jigsaw-dots__left-center{top:50%;transform:translateX(-50%) translateY(-50%);cursor:ew-resize}.jigsaw-dots__right-center{right:0;top:50%;transform:translateX(50%) translateY(-50%);cursor:ew-resize}.jigsaw-dots__left-bottom{left:0px;bottom:0px;transform:translateX(-50%) translateY(50%);cursor:nesw-resize}.jigsaw-dots__center-bottom{left:50%;bottom:0;transform:translateX(-50%) translateY(50%);cursor:ns-resize}.jigsaw-dots__right-bottom{right:0;bottom:0;transform:translateX(50%) translateY(50%);cursor:nwse-resize}\n",""]),module.exports=exports},741:function(module,exports,__webpack_require__){var api=__webpack_require__(70),content=__webpack_require__(742);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},742:function(module,exports,__webpack_require__){(exports=__webpack_require__(71)(!1)).push([module.i,".jigsaw-wrapper{display:block;position:absolute}.jigsaw-wrapper__floor{position:relative;width:100%;background:#f3dede;box-sizing:border-box}.jigsaw-wrapper__floor--selected{border:1px solid #000}.jigsaw-wrapper__block{position:relative;width:100%;overflow:hidden}.jigsaw-wrapper__control{position:absolute;left:0;top:0;right:0;bottom:0;z-index:1;box-sizing:border-box}.jigsaw-wrapper--selected{border:1px solid #000;z-index:2}.jigsaw-wrapper--selected:hover{cursor:move}.jigsaw-wrapper--fixed{position:fixed;z-index:99999;pointer-events:none;box-shadow:#ccc 5px 5px 5px}\n",""]),module.exports=exports},743:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"TreeDemo",(function(){return tree_stories_TreeDemo}));__webpack_require__(31);var _path,toConsumableArray=__webpack_require__(36),objectSpread2=__webpack_require__(3),slicedToArray=__webpack_require__(9),react=__webpack_require__(0),react_default=__webpack_require__.n(react),widget=__webpack_require__(107),use_schema=(__webpack_require__(69),__webpack_require__(105),__webpack_require__(145),__webpack_require__(92),__webpack_require__(734),__webpack_require__(735),__webpack_require__(55),__webpack_require__(95)),utils=__webpack_require__(10),constant=(__webpack_require__(50),__webpack_require__(51),__webpack_require__(78),__webpack_require__(247),__webpack_require__(183)),utils_addKey=function addKey(arr,key){return arr.includes(key)?arr:[].concat(Object(toConsumableArray.a)(arr),[key])},utils_delKey=function delKey(arr,key){var newArr=Object(toConsumableArray.a)(arr),index=newArr.indexOf(key);return~index&&newArr.splice(index,1),newArr},getDropPosition=function getDropPosition(e,target,dragEle,pos,targetNode){var position,clientY=e.clientY,_target$getBoundingCl=target.getBoundingClientRect(),top=_target$getBoundingCl.top,height=_target$getBoundingCl.height,bottom=_target$getBoundingCl.bottom,des=height*(1/4);position=clientY<=top+des?-1:clientY>=bottom-des?1:0;var targetRect=target.getBoundingClientRect(),dragMoveLeft=dragEle.getBoundingClientRect().left+(e.clientX-pos.x);return{position:position,offsetLeft:dragMoveLeft-targetRect.left>15?1:dragMoveLeft-targetRect.left<-15?-1:0}},defineProperty=(__webpack_require__(38),__webpack_require__(16)),objectWithoutProperties=__webpack_require__(124),clsx_m=__webpack_require__(74),prefix="jigsaw-tree";function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}var tree_widget_path,switch_open=function SvgSwitchOpen(props){return react.createElement("svg",_extends({className:"switch-open_svg__icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",width:32,height:32},props),_path||(_path=react.createElement("path",{d:"M512 595.858L718.482 389.34a18.286 18.286 0 0125.893 25.893L524.946 634.661a18.286 18.286 0 01-25.892 0L279.625 415.232a18.286 18.286 0 0125.893-25.893L512 595.86z"})))};function tree_widget_extends(){return(tree_widget_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}var tree_widget=function SvgTreeWidget(props){return react.createElement("svg",tree_widget_extends({className:"tree-widget_svg__icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",width:32,height:32},props),tree_widget_path||(tree_widget_path=react.createElement("path",{d:"M516.757 149.333a120.896 120.896 0 01114.006 161.174h104.064a64 64 0 0164 64v436.16a64 64 0 01-64 64h-436.16a64 64 0 01-64-64v-87.104c0-15.702 11.989-28.63 27.306-30.08l2.923-.15a90.667 90.667 0 004.395-181.226l-4.395-.107a30.23 30.23 0 01-30.08-27.307l-.15-2.944V374.507a64 64 0 0164-64h104.065a120.704 120.704 0 01-6.87-40.32c0-85.44 35.414-120.854 120.896-120.854zm0 64a56.896 56.896 0 00-53.674 75.862l30.144 85.312h-194.56v77.184a154.73 154.73 0 015.162 300.693l-5.162 1.259v57.024h436.16V374.528l-194.56-.021 30.144-85.334a56.896 56.896 0 00-53.675-75.84z"})))},tree_node=function TreeNode(_ref){for(var schema=_ref.schema,activityId=_ref.activityId,dropPosition=_ref.dropPosition,offsetLeft=_ref.offsetLeft,dragOverNode=_ref.dragOverNode,onExpand=_ref.onExpand,onClick=_ref.onClick,onNodeDragStart=_ref.onNodeDragStart,onNodeDragEnter=_ref.onNodeDragEnter,onNodeDragOver=_ref.onNodeDragOver,onNodeDragEnd=_ref.onNodeDragEnd,onNodeDrop=_ref.onNodeDrop,node=Object(objectWithoutProperties.a)(_ref,["schema","activityId","dropPosition","offsetLeft","dragOverNode","onExpand","onClick","onNodeDragStart","onNodeDragEnter","onNodeDragOver","onNodeDragEnd","onNodeDrop"]),_useState=Object(react.useState)(!1),_useState2=Object(slicedToArray.a)(_useState,2),dragNodeHighlight=_useState2[0],setDragNodeHighlight=_useState2[1],nodeRef=Object(react.useRef)(null),id=node.id,depth=node.depth,isStart=node.isStart,isEnd=node.isEnd,expanded=node.expanded,isLeaf=node.isLeaf,list=[],config=schema.config,baseClassName="".concat(prefix,"-indent-unit"),disabled="App"===id,handleExpand=function handleExpand(){onExpand(id)},i=0;i<depth;i++){var _clsx;list.push(react_default.a.createElement("span",{key:i,className:Object(clsx_m.a)(baseClassName,(_clsx={},Object(defineProperty.a)(_clsx,"".concat(baseClassName,"-start"),isStart[i]),Object(defineProperty.a)(_clsx,"".concat(baseClassName,"-end"),isEnd[i]),_clsx))}))}return react_default.a.createElement("div",{className:"".concat(prefix,"-treenode"),onDragEnter:function handleDragEnter(e){e.stopPropagation(),e.preventDefault(),onNodeDragEnter(e,node,nodeRef.current)},onDragEnd:function handleDragEnd(e){e.preventDefault(),e.stopPropagation(),setDragNodeHighlight(!1),onNodeDragEnd(e,node,nodeRef.current)},onDragOver:function handleDragOver(e){e.preventDefault(),e.stopPropagation(),onNodeDragOver(e,node,nodeRef.current)},onDrop:function handleDrop(e){e.preventDefault(),e.stopPropagation(),setDragNodeHighlight(!1),onNodeDrop(e,node,nodeRef.current)}},react_default.a.createElement("span",{"aria-hidden":"true",className:"".concat(prefix,"-indent")},list),function renderSwitcher(){return isLeaf?react_default.a.createElement("span",{className:Object(clsx_m.a)("".concat(prefix,"-switcher"),"".concat(prefix,"-switcher-noop"))},react_default.a.createElement(tree_widget,null)):react_default.a.createElement("span",{className:"".concat(prefix,"-switcher"),onClick:handleExpand},react_default.a.createElement(switch_open,{className:"".concat(prefix,expanded?"-switcher-open":"-switcher-close")}))}(),react_default.a.createElement("span",{className:Object(clsx_m.a)("".concat(prefix,"-wrapper"),Object(defineProperty.a)({},"".concat(prefix,"-wrapper--selected"),id===activityId||dragNodeHighlight)),ref:nodeRef,onClick:function handleNodeClick(){onClick(id)},onDragStart:disabled?void 0:function handleDragStart(e){setDragNodeHighlight(!0),onNodeDragStart(e,node,nodeRef.current)},draggable:!disabled},react_default.a.createElement("span",{className:"".concat(prefix,"-name")},config.name),function renderIndicator(){var style={};if(!(!disabled&&(null==dragOverNode?void 0:dragOverNode.id)===id))return null;switch(dropPosition){case-1:style.top=0,style.left=25*offsetLeft;break;case 1:case 0:style.bottom=0,style.left=25*offsetLeft}return react_default.a.createElement("div",{className:"".concat(prefix,"-indicator"),style:style})}()))};try{treenode.displayName="treenode",treenode.__docgenInfo={description:"",displayName:"treenode",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},validKey:{defaultValue:null,description:"",name:"validKey",required:!1,type:{name:"string[]"}},depth:{defaultValue:null,description:"",name:"depth",required:!0,type:{name:"number"}},expanded:{defaultValue:null,description:"",name:"expanded",required:!1,type:{name:"boolean"}},parent:{defaultValue:null,description:"",name:"parent",required:!1,type:{name:"TreeNode"}},isLeaf:{defaultValue:null,description:"",name:"isLeaf",required:!1,type:{name:"boolean"}},isStart:{defaultValue:null,description:"",name:"isStart",required:!0,type:{name:"boolean[]"}},isEnd:{defaultValue:null,description:"",name:"isEnd",required:!0,type:{name:"boolean[]"}},schema:{defaultValue:null,description:"",name:"schema",required:!0,type:{name:"Schema"}},dropPosition:{defaultValue:null,description:"",name:"dropPosition",required:!0,type:{name:"0 | 1 | -1"}},offsetLeft:{defaultValue:null,description:"",name:"offsetLeft",required:!0,type:{name:"0 | 1"}},activityId:{defaultValue:null,description:"",name:"activityId",required:!0,type:{name:"string"}},dragOverNode:{defaultValue:null,description:"",name:"dragOverNode",required:!0,type:{name:"TreeNode"}},onExpand:{defaultValue:null,description:"",name:"onExpand",required:!0,type:{name:"(id: string) => void"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"(id: string) => void"}},onNodeDragStart:{defaultValue:null,description:"",name:"onNodeDragStart",required:!0,type:{name:"(e: DragEvent<HTMLDivElement>, val: TreeNode, ref: HTMLDivElement) => void"}},onNodeDragEnter:{defaultValue:null,description:"",name:"onNodeDragEnter",required:!0,type:{name:"(e: DragEvent<HTMLDivElement>, val: TreeNode, ref: HTMLDivElement) => void"}},onNodeDragOver:{defaultValue:null,description:"",name:"onNodeDragOver",required:!0,type:{name:"(e: DragEvent<HTMLDivElement>, val: TreeNode, ref: HTMLDivElement) => void"}},onNodeDragEnd:{defaultValue:null,description:"",name:"onNodeDragEnd",required:!0,type:{name:"(e: DragEvent<HTMLDivElement>, val: TreeNode, ref: HTMLDivElement) => void"}},onNodeDrop:{defaultValue:null,description:"",name:"onNodeDrop",required:!0,type:{name:"(e: DragEvent<HTMLDivElement>, val: TreeNode, ref: HTMLDivElement) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/tree/tree-node.tsx#treenode"]={docgenInfo:treenode.__docgenInfo,name:"treenode",path:"src/tree/tree-node.tsx#treenode"})}catch(__react_docgen_typescript_loader_error){}__webpack_require__(736);var src_tree=function Tree(){var _useSchema=Object(use_schema.b)(),_useSchema2=Object(slicedToArray.a)(_useSchema,3),store=_useSchema2[0],setStore=_useSchema2[2],_useState=Object(react.useState)([]),_useState2=Object(slicedToArray.a)(_useState,2),expandedKeys=_useState2[0],setExpandedKeys=_useState2[1],_useState3=Object(react.useState)([]),_useState4=Object(slicedToArray.a)(_useState3,2),treeData=_useState4[0],setTreeData=_useState4[1],_useState5=Object(react.useState)(null),_useState6=Object(slicedToArray.a)(_useState5,2),dragOverNode=_useState6[0],setDragOverNode=_useState6[1],_useState7=Object(react.useState)(null),_useState8=Object(slicedToArray.a)(_useState7,2),dropPosition=_useState8[0],setDropPosition=_useState8[1],_useState9=Object(react.useState)(0),_useState10=Object(slicedToArray.a)(_useState9,2),offsetLeft=_useState10[0],setOffsetLeft=_useState10[1],dataRef=Object(react.useRef)([]),dragStartPosition=Object(react.useRef)(null),dragNode=Object(react.useRef)(null),dragNodeEle=Object(react.useRef)(null),timeRef=Object(react.useRef)(null),schema=store.schema,activityId=store.activityId;Object(react.useEffect)((function(){var data=function traverseDataNodes(schema){var result=[],rootItem={id:constant.b,depth:0,expanded:!0,isEnd:[!0],isStart:[!0],validKey:[]};return function processor(){var item=arguments.length>0&&void 0!==arguments[0]?arguments[0]:rootItem,cur=schema[item.id],expandable=0!==cur.children.length,realItem=Object(objectSpread2.a)(Object(objectSpread2.a)({},item),{},{expanded:!!expandable||void 0,isLeaf:!expandable});if(result.push(realItem),0!==cur.children.length){var parent=realItem;cur.children.forEach((function(child,index,arr){processor({id:child,validKey:[].concat(Object(toConsumableArray.a)(parent.validKey),[item.id]),depth:item.depth+1,parent:realItem,isStart:[].concat(Object(toConsumableArray.a)(parent?parent.isStart:[]),[0===index]),isEnd:[].concat(Object(toConsumableArray.a)(parent?parent.isEnd:[]),[index===arr.length-1])})}))}}(),result}(schema);dataRef.current=data.map((function(item){return Object(objectSpread2.a)(Object(objectSpread2.a)({},item),{},{expanded:Object(utils.d)(item.expanded)?!expandedKeys.includes(item.id):void 0})})),setTreeData(dataRef.current.filter((function(item){return!expandedKeys.some((function(key){return item.validKey.includes(key)}))})))}),[schema,expandedKeys]);var onExpand=function onExpand(id){expandedKeys.includes(id)?setExpandedKeys(utils_delKey(expandedKeys,id)):setExpandedKeys(utils_addKey(expandedKeys,id))},onClick=function onClick(id){setStore(Object(objectSpread2.a)(Object(objectSpread2.a)({},store),{},{activityId:id}))},onWindowDragEnd=function onWindowDragEnd(){!function onWinNodeDragEnd(){setDragOverNode(null)}(),window.removeEventListener("dragend",onWindowDragEnd)},onNodeDragStart=function onNodeDragStart(e,node,ele){var id=node.id;dragStartPosition.current={x:e.clientX,y:e.clientY},dragNode.current=node,dragNodeEle.current=ele,setExpandedKeys(utils_addKey(expandedKeys,id)),window.addEventListener("dragend",onWindowDragEnd)},onNodeDragEnter=function onNodeDragEnter(e,node,ele){if(timeRef.current&&clearTimeout(timeRef.current),dragNode.current){var _getDropPosition=getDropPosition(e,e.target,ele,dragStartPosition.current),position=_getDropPosition.position,offsetLeft=_getDropPosition.offsetLeft;if(node.id===dragNode.current.id&&-1!==position)return setDragOverNode(null),void setDropPosition(null);setOffsetLeft(offsetLeft),setDragOverNode(node),Object(utils.d)(node.expanded)&&!node.expanded&&(timeRef.current=setTimeout((function(){setExpandedKeys(utils_delKey(expandedKeys,node.id))}),400))}},onNodeDragOver=function onNodeDragOver(e,node,ele){if(node.id===dragNode.current.id)return setDragOverNode(null),void setDropPosition(null);if(dragNode.current){var _getDropPosition2=getDropPosition(e,e.target,ele,dragStartPosition.current),position=_getDropPosition2.position,offset=_getDropPosition2.offsetLeft;if(position===dropPosition&&offset===offsetLeft)return;setDropPosition(position),setOffsetLeft(offset),setDragOverNode(node),console.log(node,position,offset)}},onNodeDragEnd=function onNodeDragEnd(){setDragOverNode(null),dragNode.current=null},onNodeDrop=function onNodeDrop(e,node){setDragOverNode(null),dragNode.current=null};return react_default.a.createElement("div",{"data-testid":"tree",className:"jigsaw-tree"},treeData.map((function(data){return react_default.a.createElement(tree_node,Object.assign({schema:schema[data.id]},data,{key:data.id,offsetLeft:offsetLeft,dropPosition:dropPosition,activityId:activityId,dragOverNode:dragOverNode,onExpand:onExpand,onClick:onClick,onNodeDragStart:onNodeDragStart,onNodeDragEnter:onNodeDragEnter,onNodeDragOver:onNodeDragOver,onNodeDragEnd:onNodeDragEnd,onNodeDrop:onNodeDrop}))})))},context=__webpack_require__(30),treeDataDemo={63046433:{manifest:{name:"Button",cname:"按钮",version:"1.0.0"},config:{name:"Button",width:100,height:30,canDrag:!0,canAddAsChild:!1,props:{btnText:"按钮"},x:50,y:99},props:{btnText:"按钮"},id:"63046433",children:[],parent:"63045cfa"},63047798:{manifest:{name:"Card",cname:"卡片",version:"1.0.0"},config:{name:"Card",width:242,height:124,canDrag:!0,canAddAsChild:!0,props:{bordered:!1,title:"卡片"},x:44,y:193},props:{bordered:!1,title:"卡片"},id:"63047798",children:["6304bcf6"],parent:"63045cfa"},App:{id:"App",props:{},children:["63043c47","6304551c"],config:{name:"App",canDrag:!1,canAddAsChild:!0,props:{},height:650},manifest:{name:"App",cname:"拼图",version:"1.0.0"}},"63043c47":{manifest:{name:"Floor",cname:"楼",version:"1.0.0"},config:{name:"Floor",width:"100%",x:0,y:0,height:650,canDrag:!1,canAddAsChild:!0,props:{}},props:{},id:"63043c47",children:["63045cfa"],parent:"App"},"6304551c":{manifest:{name:"Floor",cname:"楼",version:"1.0.0"},config:{name:"Floor",width:"100%",x:0,y:0,height:650,canDrag:!1,canAddAsChild:!0,props:{}},props:{},id:"6304551c",children:["6304d5a6","6304d7f6","6304d8ac"],parent:"App"},"63045cfa":{manifest:{name:"Card",cname:"楼",version:"1.0.0"},config:{name:"Card",width:316,height:350,canDrag:!0,canAddAsChild:!0,props:{bordered:!1,title:"卡片"},x:25,y:25},props:{bordered:!1,title:"卡片"},id:"63045cfa",children:["63046433","63047798"],parent:"63043c47"},"6304bcf6":{manifest:{name:"Button",cname:"楼",version:"1.0.0"},config:{name:"Button",width:100,height:30,canDrag:!0,canAddAsChild:!1,props:{btnText:"按钮"},x:44,y:69},props:{btnText:"按钮"},id:"6304bcf6",children:[],parent:"63047798"},"6304d5a6":{manifest:{name:"Button",cname:"按钮",version:"1.0.0"},config:{name:"Button",width:100,height:30,canDrag:!0,canAddAsChild:!1,props:{btnText:"按钮"},x:0,y:0},props:{btnText:"按钮"},id:"6304d5a6",children:[],parent:"6304551c"},"6304d7f6":{manifest:{name:"Button",cname:"按钮",version:"1.0.0"},config:{name:"Button",width:100,height:30,canDrag:!0,canAddAsChild:!1,props:{btnText:"按钮"},x:0,y:30},props:{btnText:"按钮"},id:"6304d7f6",children:[],parent:"6304551c"},"6304d8ac":{manifest:{name:"Card",cname:"卡片",version:"1.0.0"},config:{name:"Card",width:316,height:350,canDrag:!0,canAddAsChild:!0,props:{title:"卡片"},x:0,y:60},props:{bordered:!1,title:"卡片"},id:"6304d8ac",children:[],parent:"6304551c"}},manifest={name:"test",cname:"测试",version:"0.0.1",icon:"",preview:""},tree_stories_TreeCpn=function TreeCpn(){var _useState=Object(react.useState)(Object(objectSpread2.a)(Object(objectSpread2.a)({},context.b.store),{},{schema:treeDataDemo})),_useState2=Object(slicedToArray.a)(_useState,2),store=_useState2[0],setStore=_useState2[1];Object(react.useEffect)((function(){setStore(Object(objectSpread2.a)(Object(objectSpread2.a)({},store),{},{configs:[].concat(Object(toConsumableArray.a)(store.configs),[{name:"test",width:100,height:100}])}))}),[]);var value={store:store,setStore:setStore};return react_default.a.createElement("div",null,react_default.a.createElement(context.a.Provider,{value:value},react_default.a.createElement(widget.a,{manifest:manifest},react_default.a.createElement("div",null,"添加")),react_default.a.createElement(src_tree,null)))},tree_stories_TreeDemo=(__webpack_exports__.default={title:"Tree"},function TreeDemo(){return react_default.a.createElement(tree_stories_TreeCpn,null)})},744:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"WithContainer",(function(){return wrapper_stories_WithContainer}));__webpack_require__(69),__webpack_require__(38);var objectSpread2=__webpack_require__(3),slicedToArray=__webpack_require__(9),react=__webpack_require__(0),react_default=__webpack_require__.n(react),context=__webpack_require__(30),defineProperty=__webpack_require__(16),clsx_m=__webpack_require__(74),src_dots=(__webpack_require__(31),__webpack_require__(739),function Dots(_ref){var row=_ref.row,column=_ref.column,onMouseDown=_ref.onMouseDown;return react_default.a.createElement("div",{"data-testid":"dots",className:Object(clsx_m.a)("jigsaw-dots","jigsaw-dots__".concat(row,"-").concat(column)),onMouseDown:onMouseDown})});try{dots.displayName="dots",dots.__docgenInfo={description:"",displayName:"dots",props:{row:{defaultValue:null,description:"",name:"row",required:!0,type:{name:"enum",value:[{value:'"left"'},{value:'"center"'},{value:'"right"'}]}},column:{defaultValue:null,description:"",name:"column",required:!0,type:{name:"enum",value:[{value:'"center"'},{value:'"top"'},{value:'"bottom"'}]}},onMouseDown:{defaultValue:null,description:"",name:"onMouseDown",required:!0,type:{name:"(evt: MouseEvent<HTMLDivElement, MouseEvent>) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/dots/index.tsx#dots"]={docgenInfo:dots.__docgenInfo,name:"dots",path:"src/dots/index.tsx#dots"})}catch(__react_docgen_typescript_loader_error){}var utils=__webpack_require__(10),dotsList=[["left","top"],["left","center"],["left","bottom"],["center","top"],["center","bottom"],["right","top"],["right","center"],["right","bottom"]],prefix="jigsaw-wrapper",getReverseBy=function getReverseBy(config,row,col){var num,dotsList=function getDotsLocBy(config){var x=config.x,y=config.y,width=config.width,height=config.height;if("number"!=typeof height)throw new Error("width/height should be a number");return[{x:x,y:y},{x:Object(utils.e)(width)?x+width:x,y:y},{x:x,y:y+height},{x:Object(utils.e)(width)?x+width:x,y:y+height}]}(config);return"left"===row&&"top"===col&&(num=3),"left"===row&&"center"===col&&(num=1),"left"===row&&"bottom"===col&&(num=1),"center"===row&&"top"===col&&(num=3),"center"===row&&"bottom"===col&&(num=0),"right"===row&&"top"===col&&(num=2),"right"===row&&"center"===col&&(num=0),"right"===row&&"bottom"===col&&(num=0),[dotsList[dotsList.length-1-num],dotsList[num]]},resolveMouseEffect=function resolveMouseEffect(firstLoc,realLoc){var x=firstLoc.x,y=firstLoc.y;return[realLoc.x<x?realLoc.x:x,realLoc.y<y?realLoc.y:y,Math.abs(realLoc.x-x),Math.abs(realLoc.y-y)]},getValidByRange=function getValidByRange(num,min,max){return num<min?min:num>max?max:num},wrapper_floor=function FloorWrapper(_ref){var id=_ref.id,children=_ref.children,_useContext=Object(react.useContext)(context.a),store=_useContext.store,setStore=_useContext.setStore,schema=store.schema,config=schema[id].config,isSelected=id&&store.activityId===id,height=config.height;return react_default.a.createElement("div",{style:{height:Object(utils.h)(height)},className:"".concat(prefix,"__floor"),onMouseEnter:function handleMouseEnter(){store.dragInfo.dragId&&(console.log("dragId",id),setStore(Object(objectSpread2.a)(Object(objectSpread2.a)({},store),{},{dragInfo:Object(objectSpread2.a)(Object(objectSpread2.a)({},store.dragInfo),{},{activeId:id})})))},id:"E".concat(id)},react_default.a.createElement("div",{className:Object(clsx_m.a)("".concat(prefix,"__control"),Object(defineProperty.a)({},"".concat(prefix,"__floor--selected"),isSelected)),onClick:function handleFloorClick(e){e.preventDefault(),setStore(Object(objectSpread2.a)(Object(objectSpread2.a)({},store),{},{activityId:id}))}},isSelected&&react_default.a.createElement(src_dots,{row:"center",column:"bottom",onMouseDown:function onMouseDown(evt){return function handleDotsMouseDown(e,row,col){e.preventDefault();var t1=Object(utils.j)(document.body,e.clientX,e.clientY),_getReverseBy=getReverseBy(config,row,col),_getReverseBy2=Object(slicedToArray.a)(_getReverseBy,2),m=_getReverseBy2[0],n=_getReverseBy2[1],handleMove=function handleMove(e){var realLoc,t2=Object(utils.j)(document.body,e.clientX,e.clientY),distance_x=t2.x-t1.x,distance_y=t2.y-t1.y;realLoc="center"===row?{x:m.x,y:m.y+distance_y}:"center"===col?{x:m.x+distance_x,y:m.y}:{x:m.x+distance_x,y:m.y+distance_y};var _resolveMouseEffect=resolveMouseEffect(n,realLoc),_resolveMouseEffect2=Object(slicedToArray.a)(_resolveMouseEffect,4),x=_resolveMouseEffect2[0],y=_resolveMouseEffect2[1],width=_resolveMouseEffect2[2],height=_resolveMouseEffect2[3];setStore(Object(objectSpread2.a)(Object(objectSpread2.a)({},store),{},{schema:Object(objectSpread2.a)(Object(objectSpread2.a)({},schema),{},Object(defineProperty.a)({},id,Object(objectSpread2.a)(Object(objectSpread2.a)({},schema[id]),{},{config:Object(objectSpread2.a)(Object(objectSpread2.a)({},schema[id].config),{},{x:x,y:y,width:width,height:height})})))}))};document.addEventListener("mousemove",handleMove),document.addEventListener("mouseup",(function handleMouseUp(){document.removeEventListener("mousemove",handleMove),document.removeEventListener("mouseup",handleMouseUp)}))}(evt,"center","bottom")}})),react_default.a.createElement("div",{style:{height:Object(utils.h)(height)},className:"".concat(prefix,"__block")},children))};try{floor.displayName="floor",floor.__docgenInfo={description:"",displayName:"floor",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/wrapper/floor.tsx#floor"]={docgenInfo:floor.__docgenInfo,name:"floor",path:"src/wrapper/floor.tsx#floor"})}catch(__react_docgen_typescript_loader_error){}__webpack_require__(55);var utils_schema=__webpack_require__(44),wrapper_widget=function WidgetWrapper(_ref){var id=_ref.id,children=_ref.children,_useContext=Object(react.useContext)(context.a),store=_useContext.store,setStore=_useContext.setStore,widgetRef=Object(react.useRef)(null),storeRef=Object(react.useRef)(null),schema=store.schema,config=schema[id].config,isSelected=id&&store.activityId===id,width=config.width,height=config.height,_config$x=config.x,x=void 0===_config$x?0:_config$x,_config$y=config.y,y=void 0===_config$y?0:_config$y,canDrag=config.canDrag;Object(react.useEffect)((function(){storeRef.current=store}),[store]);return react_default.a.createElement("div",{style:{width:Object(utils.h)(width),height:Object(utils.h)(height),left:Object(utils.h)(x),top:Object(utils.h)(y)},className:prefix,id:"E".concat(id),ref:widgetRef},react_default.a.createElement("div",{className:Object(clsx_m.a)("".concat(prefix,"__control"),Object(defineProperty.a)({},"".concat(prefix,"--selected"),isSelected)),onMouseDown:canDrag?function handleWidgetClick(e){e.preventDefault(),e.stopPropagation();var rect=e.target.getBoundingClientRect(),deltaX=e.clientX-rect.x,deltaY=e.clientY-rect.y;widgetRef.current.classList.add("".concat(prefix,"--fixed"));var wrapperId=Object(utils.c)(schema,schema[id]);setStore(Object(objectSpread2.a)(Object(objectSpread2.a)({},store),{},{activityId:id,dragInfo:{dragId:id,activeId:wrapperId,deltaX:deltaX,deltaY:deltaY},schema:Object(objectSpread2.a)(Object(objectSpread2.a)({},schema),{},Object(defineProperty.a)({},id,Object(objectSpread2.a)(Object(objectSpread2.a)({},schema[id]),{},{config:Object(objectSpread2.a)(Object(objectSpread2.a)({},schema[id].config),{},{x:rect.x,y:rect.y})})))}));var handleWidgetMove=function handleWidgetMove(e){e.preventDefault(),e.stopPropagation();var location_x=e.clientX-deltaX,location_y=e.clientY-deltaY,ele=document.querySelector("#E".concat(id));Object.assign(ele.style,{left:location_x+"px",top:location_y+"px"})};document.addEventListener("mousemove",handleWidgetMove),document.addEventListener("mouseup",(function handleWidgetUp(e){widgetRef.current.classList.remove("".concat(prefix,"--fixed"));var _storeRef$current=storeRef.current,schema=_storeRef$current.schema,dragInfo=_storeRef$current.dragInfo,dragId=dragInfo.dragId,activeId=dragInfo.activeId,realSchema=schema;wrapperId!==activeId&&(realSchema=Object(utils_schema.h)(schema,dragId,activeId));var wrapEle=document.querySelector("#E".concat(activeId)),_wrapEle$getBoundingC=wrapEle.getBoundingClientRect(),x=_wrapEle$getBoundingC.x,y=_wrapEle$getBoundingC.y,width=_wrapEle$getBoundingC.width,height=_wrapEle$getBoundingC.height;if(wrapEle){var realLocation={x:getValidByRange(e.clientX-deltaX-x,-config.width/2,width-config.width/2),y:getValidByRange(e.clientY-deltaY-y,-config.height/2,height-config.height/2)};setStore(Object(objectSpread2.a)(Object(objectSpread2.a)({},storeRef.current),{},{dragInfo:{},schema:Object(objectSpread2.a)(Object(objectSpread2.a)({},realSchema),{},Object(defineProperty.a)({},id,Object(objectSpread2.a)(Object(objectSpread2.a)({},realSchema[id]),{},{config:Object(objectSpread2.a)(Object(objectSpread2.a)({},realSchema[id].config),{},{x:realLocation.x,y:realLocation.y})})))})),document.removeEventListener("mousemove",handleWidgetMove),document.removeEventListener("mouseup",handleWidgetUp)}}))}:null},isSelected&&dotsList.map((function(_ref2,index){var _ref3=Object(slicedToArray.a)(_ref2,2),row=_ref3[0],col=_ref3[1];return react_default.a.createElement(src_dots,{key:index,row:row,column:col,onMouseDown:function onMouseDown(evt){return function handleDotsMouseDown(e,row,col){e.preventDefault(),e.stopPropagation();var t1=Object(utils.j)(document.body,e.clientX,e.clientY),_getReverseBy=getReverseBy(config,row,col),_getReverseBy2=Object(slicedToArray.a)(_getReverseBy,2),m=_getReverseBy2[0],n=_getReverseBy2[1],handleMove=function handleMove(e){e.preventDefault(),e.stopPropagation();var realLoc,t2=Object(utils.j)(document.body,e.clientX,e.clientY),distance_x=t2.x-t1.x,distance_y=t2.y-t1.y;realLoc="center"===row?{x:m.x,y:m.y+distance_y}:"center"===col?{x:m.x+distance_x,y:m.y}:{x:m.x+distance_x,y:m.y+distance_y};var _resolveMouseEffect=resolveMouseEffect(n,realLoc),_resolveMouseEffect2=Object(slicedToArray.a)(_resolveMouseEffect,4),x=_resolveMouseEffect2[0],y=_resolveMouseEffect2[1],width=_resolveMouseEffect2[2],height=_resolveMouseEffect2[3];setStore(Object(objectSpread2.a)(Object(objectSpread2.a)({},store),{},{schema:Object(objectSpread2.a)(Object(objectSpread2.a)({},schema),{},Object(defineProperty.a)({},id,Object(objectSpread2.a)(Object(objectSpread2.a)({},schema[id]),{},{config:Object(objectSpread2.a)(Object(objectSpread2.a)({},schema[id].config),{},{x:x,y:y,width:width,height:height})})))}))};document.addEventListener("mousemove",handleMove),document.addEventListener("mouseup",(function handleMouseUp(){document.removeEventListener("mousemove",handleMove),document.removeEventListener("mouseup",handleMouseUp)}))}(evt,row,col)}})}))),children)};try{widget.displayName="widget",widget.__docgenInfo={description:"",displayName:"widget",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/wrapper/widget.tsx#widget"]={docgenInfo:widget.__docgenInfo,name:"widget",path:"src/wrapper/widget.tsx#widget"})}catch(__react_docgen_typescript_loader_error){}__webpack_require__(741);var src_wrapper=function Wrapper(_ref){var id=_ref.id,children=_ref.children,name=Object(react.useContext)(context.a).store.schema[id].manifest.name;return"App"===name?react_default.a.createElement(react_default.a.Fragment,null,children):"Floor"===name?react_default.a.createElement(wrapper_floor,{id:id},children):react_default.a.createElement(wrapper_widget,{id:id},children)};try{wrapper.displayName="wrapper",wrapper.__docgenInfo={description:"",displayName:"wrapper",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/wrapper/index.tsx#wrapper"]={docgenInfo:wrapper.__docgenInfo,name:"wrapper",path:"src/wrapper/index.tsx#wrapper"})}catch(__react_docgen_typescript_loader_error){}var src_widget=__webpack_require__(107),components=__webpack_require__(153),wrapper_stories_Container=function Container(){var _useState=Object(react.useState)(context.b.store),_useState2=Object(slicedToArray.a)(_useState,2),store=_useState2[0],setStore=_useState2[1];Object(react.useEffect)((function(){var manifestList=["Floor"].map((function(name){return components.a[name].manifest})),_initBy=Object(utils_schema.g)(store,manifestList),_initBy2=Object(slicedToArray.a)(_initBy,2),newSchema=_initBy2[0],lastId=_initBy2[1];setStore(Object(objectSpread2.a)(Object(objectSpread2.a)({},store),{},{activityId:lastId,schema:newSchema}))}),[]);var value={store:store,setStore:setStore};return react_default.a.createElement("div",null,react_default.a.createElement(context.a.Provider,{value:value},react_default.a.createElement("div",{onClick:function handleFloorAdd(){var newStore=Object(utils_schema.b)(store,"BOTTOM");setStore(newStore)}},"添加楼层"),react_default.a.createElement(src_widget.a,{manifest:{name:"Button",cname:"按钮",version:"1.0.0"}},react_default.a.createElement("div",null,"Button")),react_default.a.createElement(src_widget.a,{manifest:{name:"Card",cname:"卡片",version:"1.0.0"}},react_default.a.createElement("div",null,"Card")),react_default.a.createElement("div",{style:{marginLeft:100,position:"relative",width:375}},function renderWrapper(scheme){var children=scheme.children,id=scheme.id,manifest=scheme.manifest,props=scheme.props,component=components.a[manifest.name],getChildren=0!==children.length?children.map((function(id){return renderWrapper(store.schema[id])})):null;return react_default.a.createElement(src_wrapper,{key:id,id:id},Object(react.createElement)(component.view,props,getChildren))}(store.schema.App))))},wrapper_stories_WithContainer=(__webpack_exports__.default={title:"Wrapper"},function WithContainer(){return react_default.a.createElement(wrapper_stories_Container,null)})},745:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"WithBar",(function(){return container_stories_WithBar})),__webpack_require__.d(__webpack_exports__,"WithBaz",(function(){return container_stories_WithBaz}));var react=__webpack_require__(0),react_default=__webpack_require__.n(react),slicedToArray=__webpack_require__(9),context=__webpack_require__(30),src_container=(__webpack_require__(728),function Container(){var _useState=Object(react.useState)(null),_useState2=Object(slicedToArray.a)(_useState,2),value={store:_useState2[0],setStore:_useState2[1]};return react_default.a.createElement(context.a.Provider,{value:value},react_default.a.createElement("div",{"data-testid":"container",className:"foo-bar"}))});try{container.displayName="container",container.__docgenInfo={description:"",displayName:"container",props:{foo:{defaultValue:null,description:"",name:"foo",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/container/index.tsx#container"]={docgenInfo:container.__docgenInfo,name:"container",path:"src/container/index.tsx#container"})}catch(__react_docgen_typescript_loader_error){}__webpack_exports__.default={title:"Container"};var container_stories_WithBar=function WithBar(){return react_default.a.createElement(src_container,{foo:"bar"})},container_stories_WithBaz=function WithBaz(){return react_default.a.createElement(src_container,{foo:"baz"})}},746:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"WithBar",(function(){return tools_stories_WithBar})),__webpack_require__.d(__webpack_exports__,"WithBaz",(function(){return tools_stories_WithBaz}));var react=__webpack_require__(0),react_default=__webpack_require__.n(react),src_tools_tools=(__webpack_require__(730),function tools(_ref){var foo=_ref.foo;return react_default.a.createElement("div",{"data-testid":"tools",className:"foo-bar"},foo)}),src_tools=src_tools_tools;try{src_tools_tools.displayName="tools",src_tools_tools.__docgenInfo={description:"",displayName:"tools",props:{foo:{defaultValue:null,description:"",name:"foo",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/tools/index.tsx#tools"]={docgenInfo:src_tools_tools.__docgenInfo,name:"tools",path:"src/tools/index.tsx#tools"})}catch(__react_docgen_typescript_loader_error){}__webpack_exports__.default={title:"tools"};var tools_stories_WithBar=function WithBar(){return react_default.a.createElement(src_tools,{foo:"bar"})},tools_stories_WithBaz=function WithBaz(){return react_default.a.createElement(src_tools,{foo:"baz"})}},95:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ActionEnum}));var ActionEnum,_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9),_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(16),_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(0),_utils_schema__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(44),_common_context__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(30);!function(ActionEnum){ActionEnum.INIT="INIT",ActionEnum.ADD="ADD",ActionEnum.DELETE="DELETE",ActionEnum.REPLACE="REPLACE",ActionEnum.CLONE="CLONE",ActionEnum.UPDATE="UPDATE"}(ActionEnum||(ActionEnum={}));var isScheme=function isScheme(val){return void 0!==val.config};__webpack_exports__.b=function useSchema(){var _useContext=Object(react__WEBPACK_IMPORTED_MODULE_3__.useContext)(_common_context__WEBPACK_IMPORTED_MODULE_5__.a),store=_useContext.store,setStore=_useContext.setStore,activityId=store.activityId,schema=store.schema;return[store,function dispatch(type,payload){if(type===ActionEnum.ADD&&isScheme(payload)){var newSchema=Object(_utils_schema__WEBPACK_IMPORTED_MODULE_4__.a)(schema,activityId,payload);setStore(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_2__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_2__.a)({},store),{},{activityId:payload.id,schema:newSchema}))}else if(type===ActionEnum.DELETE&&isScheme(payload)){var id=payload.id,lastActivityId=Object(_utils_schema__WEBPACK_IMPORTED_MODULE_4__.e)(schema,payload),_newSchema=Object(_utils_schema__WEBPACK_IMPORTED_MODULE_4__.d)(schema,id);if(0===Object(_utils_schema__WEBPACK_IMPORTED_MODULE_4__.f)(_newSchema).length)return;setStore(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_2__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_2__.a)({},store),{},{activityId:lastActivityId,schema:_newSchema}))}else if(type===ActionEnum.UPDATE&&isScheme(payload)){var _id=payload.id,_newSchema2=Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_2__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_2__.a)({},schema),{},Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_1__.a)({},_id,payload));setStore(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_2__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_2__.a)({},store),{},{activityId:payload.id,schema:_newSchema2}))}else if(type===ActionEnum.CLONE&&isScheme(payload)){var _cloneDeepBy=Object(_utils_schema__WEBPACK_IMPORTED_MODULE_4__.c)(schema,activityId),_cloneDeepBy2=Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__.a)(_cloneDeepBy,2),_newSchema3=_cloneDeepBy2[0],rootId=_cloneDeepBy2[1];if(!schema[activityId].parent)throw new Error("can't clone");setStore(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_2__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_2__.a)({},store),{},{activityId:rootId,schema:_newSchema3}))}else if(type===ActionEnum.REPLACE&&function isReplace(val){return!!val.from}(payload)){var from=payload.from,to=payload.to,data=payload.data,_newSchema4=Object(_utils_schema__WEBPACK_IMPORTED_MODULE_4__.h)(schema,from,to);setStore(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_2__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_2__.a)({},store),{},{activityId:data.id,schema:_newSchema4}))}else if(type===ActionEnum.INIT&&function isManifest(val){return!!val.length}(payload)){var _initBy=Object(_utils_schema__WEBPACK_IMPORTED_MODULE_4__.g)(store,payload),_initBy2=Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__.a)(_initBy,2),_newSchema5=_initBy2[0],lastId=_initBy2[1];setStore(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_2__.a)(Object(_Users_yangzhao_workspace_my_jigsaw_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_2__.a)({},store),{},{activityId:lastId,schema:_newSchema5}))}else;},setStore]}}},[[362,1,2]]]);
//# sourceMappingURL=main.1a88d883b1022c48569e.bundle.js.map